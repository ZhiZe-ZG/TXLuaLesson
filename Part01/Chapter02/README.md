# Chapter 02 安装Lua

上一回我们置办了一堆设备。但是最后如何把各种平台统一起来，我只是给出了一个泛泛而谈的建议。具体的操作流程并没有截图加说明给出。说实话，我挺惊讶你会看到这里，而不是直接放弃。

现在我们开始第二步准备工作——安装Lua。

## 资源

Lua的官方网址是<https://www.lua.org/>。Lua的源码，教程，文档都能从上边获取。

我们这一章的任务是从网上获取Lua源码，然后编译安装。如果觉得从头编译安装Lua有困难，可以考虑下载预编译的安装包，或者通过包管理软件来安装Lua。

## 下载，编译，安装

在官网上的“Download”页面下载最新稳定版的源码包。使用命令`tar -xzf`解压源码包。例如：

```shell
tar -xzf lua-5.3.5.tar.gz
```

解压的文件存放在`lua-5.3.5`这个路径下。使用`cd`命令进入这个路径，然后依次运行以下命令：

```shell
make linux
make install
```

> 如果之前安装了Lua，建议先删除。
>
> `make install`命令会默认将Lua安装到系统，可能需要管理员权限。
>
> 安装完成后的源码包不要扔。以后想卸载软件的时候，你还要到这个路径下执行`make uninstall`来卸载Lua。
>
> 另外注意，卸载Lua的时候`make uninstall`也是需要管理员权限的。

## 启动Lua

Lua是一个软件，我们通过同样名为Lua的编程语言与之交流。在Shell中使用命令`lua`启动Lua。此时命令行被Lua的交互式编程环境替代。我们直接输入Lua语句，这个软件就会按照语句命令执行操作。使用快捷键<kbd>Ctrl</kbd>+<kbd>d</kbd>关闭交互式编程环境，回到Shell。

Lua语言还有另一种用法，那就是用Lua语言写一个文本文件。在启动Lua时在命令`lua`后加文件名作为参数。这样Lua就会按照文本中的命令逐条执行。正常执行完成后，退出回到Shell。

## 交互式编程

现在我们来学习第一个Lua命令`print()`。这个命令的作用就是输出括号中的内容。如果括号里什么都没有，它就输出一个空行。

为了让它输出点容易识别的东西，我们让它输出一句话：

```lua
print('hello lua!')
```

引号的作用是告诉Lua这是一个字符串，把引号内的内容输出，但是不要输出引号本身。之所以要用引号，是因为Lua中不加引号的单词可能被当作变量。至于变量和变量命名我们以后再讨论。目前需要知道的是，如果不加引号，这个命令不会按照我们预期的那样执行。

按照上边的例句，在交互式编程环境中输入命令，回车执行。

一般在Lua的交互式编程环境中命令都是一行就写完。但是当我们书代码块的时候（以后再详细解释“代码块”这个词），如果没有写完就回车，交互式编程环境会自动进入多行模式。也就是等后边几行的内容都写完之后才把这几行代码当作一个整体执行。这些细节我们之后还有机会讨论。这里给出一个例子。

```lua
do
    print('hello lua')
    print('hello C')
end
```

按照顺序逐条输入（第2，3行的行首缩进不是必须的），输入`end`并回车后两个`print`才会执行。这里的`do`和`end`就是多行语句的头尾标记。当输入`do`之后Lua就会等待你输入的与之对应的`end`。直到等到对应的`end`输入后，才会把`do`和`end`之间的命令按顺序逐条执行一次。

## 也试试脚本

把命令逐条记在文本文件中让Lua去执行，就像把台词剧本交给演员去按顺序读。因此记录命令的这些文本文件又叫做“脚本”。

> “脚本”(Script)一词本来就是指剧本。可能由于命令式编程中写程序就像给计算机写演出剧本，人们也用这个词来指程序源码。不过被称为“脚本”的程序源码一般是可以不经过编译直接在解释器中运行的。比如C源码文件一般不叫脚本，但是Lua的源码文件可以叫做脚本。

我们试着创建一个文件，命名为`test.lua`，然后输入以下内容。

```lua
print('hello script')
print('goodbye script')
```

在Shell中通过以下命令执行：

```shell
lua test.lua
```

## 再试试命令行参数

启动Lua的时候，可以使用一些命令行参数。

如果你想让Lua先执行一个脚本，然后再在脚本运行过的这个虚拟机中开启交互式编程环境。