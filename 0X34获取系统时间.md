# 0X34获取系统时间

## 前置知识

* 0X32模块搜寻

## 正文

### 时间度量

在计算机中为了同一各个部分的工作,引入了时钟.硬件层面的时钟一般是一个能够发出周期性电磁脉冲的电子元器件.每当它发出一定数量的脉冲后,机器就会执行一个动作或者说一条指令.

一般来说这个时钟的周期是相当稳定的.所以可以通过计算时钟脉冲的个数来度量时间间隔.

### 计时标准

现在我们有了度量时间的工具,但是我们还没有一个计时的起点.对于计算机系统内部而言,完全可以随意取一个计时起点--例如从开机开始计时.但是这不符合人类的习惯.为了记录我们的历史,我们编制了各种各样的立法和计时方法.比如现在是公元2017年11月20日23时01分不知道多少秒.那么现在这个时刻就距离传说中耶稣降生的那一年的开始已经过去了两千灵一十七年,十一个月,二十天,二十三个小时零一分钟.

为了使得这套时间标准在全人类间通行,现在的方法是各种电脑手机和其他电子设备隔一段时间就联网校准一次时间.在不通过互联网校准的这段时间内,则通过主板上的计时器来记录时间的流逝.

为了在一台电脑内部统一各个应用程序的时间,操作系统会把时间查询作为一种服务提供给各个应用程序.就好像电话报时业务.应用程序在需要的时候就会去找操作系统查询时间.

Lua一般而言只是作为操作系统上的一个应用程序,所以一般来说它也需要从操作系统那里获取时间.以下的所有函数都在os模块中.

### 获取当前时刻

不知道还有多少人记得物理学中时间和时刻的区别.在这里我用时间表示两个时刻之差.

调用os.date()会返回一个字符串.字符串中显示了当前的年月日小时分钟秒.

它可以接受一个参数,这个参数是字符串,规定返回日期和时间个格式.

首先字符串如果以'!'开头.则可以保证是按UTC计算当前时间(有的系统比如Windows中会默认主板时间是当地时间而不是UTC时间).

'*t'应当紧跟'!',如果没有'!'则它在开头.当有这个参数的时候os.date()函数会返回一个表.表中的索引和其值的意义如下:

| 索引 | 意义 |
| ---- | ---- |
| year | 年 |
| month | 月 |
| wday | 日(星期几) |
| day | 日(按月计) |
| yday | 日(按年计) |
| hour | 小时 |
| min | 分钟 |
| sec | 秒 |
| isdst | 是否夏令时 |

如果格式字符串不是'*t'.则这个函数返回一个字符串.格式控制字符串的效果和标准C中的strftime一致.这个函数的格式控制字符串和之前介绍过的格式字符串生成函数类似.控制字符串中的普通字符会原样输出.百分号和其后一个字母(或两个)组成占位符,被系统时间替代.例如这行代码会输出'hello '和星期几:

>```lua
>os.date('hello %A')
>```

具体的占位符和效果如下表:

| 字母 | 意义 |
| ---- | ---- |
| % | 两个连续的百分号表示输出百分号本身 |
| Y | 十进制年份 |
| b | 月份英文名简写 |
| B | 月份英文名全称 |
| m | 月份对应的数字 |
| U | 显示在一年中的第几周(周日是一周第一天) |
| W | 显示一年中的第几周(周一是一周第一天) |
| j | 显示一年中的第几天 |
| d | 显示一个月中的第几天 |
| a | 用英文简写显示星期几 |
| A | 用英文全称显示星期几 |
| w | 显示星期几对应的数字,周日是0 |
| H | 显示二十四小时制小时 |
| I | 显示十二小时制小时 |
| M | 显示分钟 |
| S | 显示秒钟 |
| c | 用默认标准时间显示日期和时间 |
| x | 用本地化的语言和习惯显示日期 |
| X | 用本地化的语言和习惯显示时刻 |
| Z | 显示时区 |

由于编译时系统可能不支持C99的新样式,所以没有加入C99的写法.

## 后续推荐

* 0X36度量时间